{% extends 'base.html' %}
{% block head %}

  <link href="/static/results.css" rel="stylesheet">
  <script src="http://code.jquery.com/jquery.js"></script>
  <script src="/static/savejob.js"></script>
  <script src="/static/companymap.js"></script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key={{ gmaps }}&callback=initMap">
  </script>
{% endblock %}

{% block body %}
<title>Work Near BART - Results</title>

<form action="/results/1">
<div class="row text-center">
  Origin: <select name="origin_station">
    <option value="None">optional</option>   
    {% for station in all_stations %}
      <option value={{ station.station_code }}>{{ station.station_name }}</option>
    {% endfor %}
  </select><br>

  Search Job Title: <input type="text" name="title" id="search-title">
  Destination: <select name="station">
    <option value="all">all SF stations</option>   
    {% for station in sf_stations %}
      <option value={{ station.station_code }}>{{ station.station_name }}</option>
    {% endfor %}
  </select>

  <select name="days">
    <option value="999">anytime</option>
    <option value="1">since yesterday</option>
    <option value="3">within 3 days</option>
    <option value="7">within 7 days</option>
    <option value="15">within 15 days</option>
    <option value="30">within 30 days</option>
  </select>

  <select name="display">
    <option value="10">10 per page</option>
    <option value="25">25 per page</option>
  </select>

  <input type="submit">

</form>
</div>

<div id="companymap"></div>

  {% if job_results %}
    {% for job in job_results[page_num * display_per_page - display_per_page : page_num * display_per_page] %}
      <div class="media">
        <img class="pull-left" src="{{ job.logo_url }}">
        <div class="media-body">
        <a href="{{ job.url }}">{{ job.title }}</a></h5><br>
        {{ job.business_name }}<br>
        Posted: {{ job.date_posted }} - {{ job.duration_posted }}<br>
        BART Station: {{ job.station_name }} | Distance: {{ job.distance }} | Walking Time: ~{{ job.duration }}<br>
        Glassdoor Rating: <a href="{{ job.glassdoor_url }}">{{ job.rating }}</a> | Industry: {{ job.industry }}<br>
        {% if fare %}
        One-Way Fare ${{ fare.get(job.station_code).get('fare') }}<br>
        {% endif %}

          {% if 'user_id' in session %}
            {% if job.job_key in saved_jobs %}
          <button name="save-job" id="{{ job.job_key }}" class="saved">Save</button>
              {% else %}
          <button name="save-job" id="{{ job.job_key }}" class="not-saved">Save</button>
            {% endif %}

          {% endif %}
        </div>  
      </div>
    {% endfor %}
  {% else %}
    <h4>No Results</h4>

  {% endif %}

    {% if num_pages > 1 %}

    <nav aria-label="pagenav">
      <ul class="pagination">

        {% for page in range(1, num_pages + 1) %}

          {% if page == page_num %}
            <li class="page-item active" id="current_page" value="{{ page }}">
          {% else %}
            <li class="page-item">
          {% endif %}

          <a class="page-link" href="/results/{{ page }}?title={{ title }}&station={{ selected_station }}&days={{ days }}&display={{ display_per_page }}">{{ page }}</a>
            </li>

        {% endfor %}
      </ul>
    </nav>

  {% endif %}

{% endblock %}